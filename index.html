<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Káva">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#21808D">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' fill='%2321808D'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='100' fill='white'%3E☕%3C/text%3E%3C/svg%3E">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' fill='%2321808D'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='100' fill='white'%3E☕%3C/text%3E%3C/svg%3E">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjogIkthdsOhdm/DoSBFdmlkZW5jZSIsICJzaG9ydF9uYW1lIjogIkvDoXZhIiwgInN0YXJ0X3VybCI6ICIuLyIsICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLCAiYmFja2dyb3VuZF9jb2xvciI6ICIjRkNGQ0Y5IiwgInRoZW1lX2NvbG9yIjogIiMyMTgwOEQiLCAiaWNvbnMiOiBbeyJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxODAgMTgwJyUzRSUzQ3JlY3Qgd2lkdGg9JzE4MCcgaGVpZ2h0PScxODAnIGZpbGw9JyUyMzIxODA4RCcvJTNFJTNDdGV4dCB4PSc1MCUyNScgeT0nNTAlMjUnIGRvbWluYW50LWJhc2VsaW5lPSdtaWRkbGUnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZvbnQtc2l6ZT0nMTAwJyBmaWxsPSd3aGl0ZSclM0UlRTIlOTglOTUlM0MvdGV4dCUzRSUzQy9zdmclM0UiLCAic2l6ZXMiOiAiMTkyeDE5MiIsICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLCAicHVycG9zZSI6ICJhbnkgbWFza2FibGUifV19">
    <title>Kávová Evidence</title>
    <style>
        :root {
            --color-background: var(--color-cream-50, #FCFCF9);
            --color-card: var(--color-surface, #FFFDFD);
            --color-text: var(--color-slate-900, #13343B);
            --color-primary: var(--color-teal-500, #21808D);
            --color-primary-hover: var(--color-teal-600, #1D7480);
            --color-border: var(--color-border, #DED9CF);
            --radius: 8px;
            --shadow: 0 1px 3px rgba(0,0,0,0.10);
            --font-size: 18px;
            --font-family: 'Inter', sans-serif;
        }
        html, body {
            background: var(--color-background);
            color: var(--color-text);
            font-family: var(--font-family);
            font-size: var(--font-size);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .container {
            max-width: 480px;
            margin: 40px auto;
            background: var(--color-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--color-border);
            padding: 32px 24px 16px 24px;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 18px;
            color: var(--color-primary);
            letter-spacing: -1px;
            text-align: center;
        }
        .user-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .user-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--color-border);
            padding: 14px 0;
        }
        .user-row:last-child {
            border-bottom: none;
        }
        .user-name {
            flex: 0 1 150px;
            font-weight: 500;
        }
        .user-count {
            flex: 0 0 40px;
            text-align: right;
            font-variant-numeric: tabular-nums;
        }
        .add-btn {
            background: var(--color-primary);
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 8px 18px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.15s;
            margin-left: 6px;
        }
        .add-btn:active, .add-btn:hover {
            background: var(--color-primary-hover);
        }
        .add-btn.double {
            background: var(--color-teal-700, #1A6873);
        }
        .add-btn.double:active, .add-btn.double:hover {
            background: var(--color-teal-800, #29969D);
        }
        .button-group {
            display: flex;
            gap: 6px;
        }
        .status-msg {
            text-align: center;
            margin: 16px 0 0 0;
            min-height: 22px;
            font-size: 1rem;
            color: var(--color-primary);
        }
        @media (max-width: 600px) {
            .container {
                padding: 12px 2px 6px 2px;
            }
            h1 {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kávová evidence</h1>
        <ul class="user-list" id="userList">
            <!-- Seznam uživatelů ze Sheetu zde -->
        </ul>
        <div class="status-msg" id="statusMsg"></div>
    </div>
    <script>
        // ENDPOINT Google Apps Scriptu (nastavte svůj nasazeny skript jako WebApp)
        const SCRIPT_URL = "PASTE_YOUR_DEPLOYED_APPS_SCRIPT_WEBAPP_URL_HERE";

        // Získej userId z URL parametru (?id=petr)
        function getUserIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        // Načti jednoho konkrétního uživatele podle ID
        function loadUser() {
            const userId = getUserIdFromUrl();
            if (!userId) {
                showStatus("Chybí ID uživatele v URL (?id=...)", true);
                return;
            }

            fetch(SCRIPT_URL + '?action=list')
            .then(r => r.json())
            .then((users) => {
                const user = users.find(u => u.id === userId);
                if (user) {
                    renderUser(user);
                } else {
                    showStatus("Uživatel nenalezen.", true);
                }
            })
            .catch(() => {
                showStatus("Chyba při načítání dat.", true);
            });
        }

        // Vykresli pouze jednoho uživatele
        function renderUser(user) {
            const userList = document.getElementById("userList");
            userList.innerHTML = "";
            const li = document.createElement("li");
            li.className = "user-row";
            li.innerHTML = `
                <span class="user-name">${user.name}</span>
                <span class="user-count" id="count-${user.id}">${user.count}</span>
                <div class="button-group">
                    <button class="add-btn" onclick="addCoffee('${user.id}', 1)">☕</button>
                    <button class="add-btn double" onclick="addCoffee('${user.id}', 2)">☕☕</button>
                </div>
            `;
            userList.appendChild(li);
        }

        // Přidej kávu uživateli
        function addCoffee(userId, amount) {
            setLoading(true, userId);
            fetch(SCRIPT_URL + '?action=add&id=' + encodeURIComponent(userId) + '&amount=' + amount, { method: "POST" })
            .then(r => r.json())
            .then(res => {
                if (res && res.ok) {
                    document.querySelector(`#count-${userId}`).textContent = res.count;
                    showStatus(amount === 2 ? "Dvojitá káva +2 ☕☕" : "Káva +1 ☕", false);
                } else {
                    showStatus("Nepodařilo se přidat kávu.", true);
                }
            })
            .catch(() => {
                showStatus("Chyba připojení.", true);
            })
            .finally(() => setLoading(false, userId));
        }

        // Loading stav na tlačítku
        function setLoading(loading, userId) {
            const buttons = document.querySelectorAll(`button[onclick*="addCoffee('${userId}'"]`);
            buttons.forEach(btn => {
                btn.disabled = loading;
                if (!loading) {
                    btn.innerHTML = btn.classList.contains('double') ? '☕☕' : '☕';
                } else {
                    btn.textContent = '...';
                }
            });
        }

        // Info pro uživatele
        function showStatus(text, error) {
            const msg = document.getElementById("statusMsg");
            msg.style.color = error ? "var(--color-error, #c0152f)" : "var(--color-primary)";
            msg.textContent = text;
        }

        // Načíst při startu
        window.addEventListener('DOMContentLoaded', loadUser);
    </script>
</body>
</html>
